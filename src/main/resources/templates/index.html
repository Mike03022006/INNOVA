<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ACCIONES</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">

  <style>
    :root{
      --mint:#e9fff5;   /* muy claro */
      --green:#66c49a;  /* medio */
      --teal:#205f77;   /* teal */
      --navy:#0c3863;   /* navy */
      --ink:#0f2430;    /* texto oscuro */
      --card:#ffffff;   /* fondos */
    }

    /* === BASE === */
    body{ background: var(--mint); color: var(--ink); }
    .bg-brand { background: linear-gradient(90deg, var(--navy), var(--teal)); }
    .text-brand { color: var(--navy); }
    .shadow-soft { box-shadow: 0 10px 30px rgba(12,56,99,0.12); }
    .rounded-2xl{ border-radius: 16px; }

    /* === NAVBAR SUPERIOR === */
    .navbar { position: sticky; top:0; z-index:1030; }
    .navbar .nav-link, .navbar-brand { color:#fff !important; }
    .badge-dot{
      width:.55rem;height:.55rem;border-radius:50%;
      display:inline-block;background:#ff4d4f; position:absolute; top:10px; right:10px;
      border:2px solid #fff;
    }

    /* === LAYOUT === */
    .main-wrap{ padding-top: 88px; } /* espacio por navbar fija */
    .sidebar{
      background: var(--card);
      border-left: 1px solid rgba(0,0,0,.06);
      padding: 20px;
      position: sticky;
      top: 96px;
      height: calc(100vh - 110px);
      overflow-y: auto;
    }

    /* === TARJETA PERFIL === */
    .profile-card{
      background: linear-gradient(135deg,var(--green),var(--teal));
      color:#fff; text-align:center; padding:18px;
    }
    .profile-card img{
      border-radius:50%; border:3px solid var(--navy);
      width:84px;height:84px;object-fit:cover;background:#fff;
    }

    /* === CTA BOTONES === */
    .btn-cta{
      border:none; font-weight:600; padding:14px 18px;
      border-radius:14px;
      background: linear-gradient(180deg, var(--green), var(--teal));
      color:#fff;
      transition: transform .06s ease, box-shadow .2s ease;
    }
    .btn-cta:hover{ transform: translateY(-1px); box-shadow:0 10px 20px rgba(12,56,99,.18); }
    .btn-cta.alt1{ background: linear-gradient(180deg, #5aaee0, var(--navy)); }
    .btn-cta.alt2{ background: linear-gradient(180deg, #145557, #145557); color:#111;}
    .btn-cta.dark { background: linear-gradient(180deg, #2f3640, #1f2327); }

    /* === SECCIÓN PRINCIPAL === */
    .hero-title{ font-weight:800; letter-spacing:.2px; }

    /* === CALENDARIO (FullCalendar) === */
    .calendar-box{
      background: var(--card);
      border: 1px solid rgba(0,0,0,.06);
      border-radius: 16px;
      overflow: hidden;
    }
    .calendar-box h5{
      background: linear-gradient(90deg, var(--navy), var(--teal));
      color:#fff; padding:8px 10px; margin:0; border-radius:10px 10px 0 0;
    }

    /* ====== Estilo compacto y legible en sidebar ====== */
    #calendar { font-size: 0.92rem; padding: 8px; }

    .fc .fc-scrollgrid,
    .fc .fc-scrollgrid-liquid,
    .fc .fc-daygrid,
    .fc .fc-daygrid-body,
    .fc .fc-daygrid-body-unbalanced {
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(0,0,0,.06);
    }

    /* Cabecera de días (Lu, Ma, …) */
    .fc .fc-col-header-cell {
      background: var(--mint);
      color: var(--navy);
      font-weight: 700;
      padding: 6px 0;
      text-transform: uppercase;
      letter-spacing: .3px;
      border: none;
    }

    /* Barra superior del calendario */
    .fc .fc-toolbar.fc-header-toolbar{
      background: linear-gradient(90deg, var(--navy), var(--teal));
      color:#fff; padding:8px 10px; border-radius:10px; margin:10px 8px;
    }
    .fc .fc-toolbar-title{ font-size: 1rem; }
    .fc .fc-button{ background: transparent !important; border:none !important; color:#fff !important; }

    /* Celdas de día */
    .fc .fc-daygrid-day { border: none; }
    .fc .fc-daygrid-day-frame { padding: 6px 4px; }
    .fc .fc-daygrid-day-top{
      display:flex; justify-content:center; align-items:center; gap:6px;
    }

    /* Número del día como “pill” */
    .fc-daygrid-day-number{
      display:inline-flex; align-items:center; justify-content:center;
      width: 28px; height: 28px; line-height: 28px;
      border-radius: 8px; font-weight: 600;
      color: var(--navy) !important; text-decoration: none !important;
    }

    /* Hoy destacado */
    .fc-day-today .fc-daygrid-day-number{
      background:#ff4747; color:#fff !important; box-shadow:0 4px 12px rgba(255,71,71,.25);
    }

    /* Domingos en rojo sutil */
    .fc-day-sun .fc-daygrid-day-number{ color:#d93025 !important; }

    /* Eventos como “píldoras” */
    .fc .fc-event{
      background: var(--teal); border-color: var(--teal);
      border-radius: 8px; padding: 2px 6px; font-size: .82rem;
    }

    /* Quita subrayados azules molestos */
    .fc a { text-decoration: none; }

    /* Links bajo el calendario */
    .calendar-box a{ color: var(--navy); }
    .calendar-box a:hover{ text-decoration: underline; }
  </style>
</head>
<body>

<!-- NAV SUPERIOR -->
<nav class="navbar navbar-expand-lg bg-brand shadow-soft">
  <div class="container-fluid px-3">
    <a class="navbar-brand fw-bold" href="/">
      <i class="bi bi-box2-fill me-2"></i>SISTEMA DE ALQUILERES INNOVASER
    </a>

    <form class="d-none d-lg-block ms-3 nav-search" role="search" action="/buscar">
      <input name="q" type="search" placeholder="Buscar equipos, clientes, alquileres…" />
    </form>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#topbar" aria-controls="topbar" aria-expanded="false">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse justify-content-end" id="topbar">
      <ul class="navbar-nav align-items-center gap-2">
        <!-- Notificaciones -->
        <li class="nav-item dropdown position-relative">
          <a class="nav-link" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-bell fs-5"></i>
          </a>
          <span class="badge-dot" title="nuevas notificaciones"></span>
          <ul class="dropdown-menu dropdown-menu-end shadow">
            <li class="dropdown-header">Notificaciones</li>
            <li><a class="dropdown-item" href="#">Equipo #A123 vence hoy</a></li>
            <li><a class="dropdown-item" href="#">Nueva empresa registrada</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="/notificaciones">Ver todas</a></li>
          </ul>
        </li>

        <!-- Usuario / Logout (Spring Security) -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" data-bs-toggle="dropdown">
            <i class="bi bi-person-circle me-1"></i>
            <span th:text="${usuarioNombre} ?: ${#authentication?.name}">Usuario</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end shadow">
            <li><a class="dropdown-item" href="/perfil"><i class="bi bi-gear me-2"></i>Perfil</a></li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <form th:action="@{/logout}" method="post" class="px-3">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                <button class="btn btn-sm btn-danger w-100" type="submit">
                  <i class="bi bi-box-arrow-right me-1"></i> Cerrar sesión
                </button>
              </form>
            </li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- CONTENIDO -->
<div class="container-fluid main-wrap">
  <div class="row g-4">

    <!-- Principal -->
    <div class="col-lg-9">
      <div class="text-center mb-4">
        <h1 class="hero-title display-5 fw-bold text-brand">
          <i class="bi bi-box-seam me-2"></i>ACCIONES
        </h1>
      </div>

      <div class="d-grid gap-3 col-md-8 col-lg-6 mx-auto">
        <a href="/equipos" class="btn btn-cta">Ver Equipos</a>
        <a href="/menu_empresas" class="btn btn-cta alt1">Ver Empresas</a>
        <a href="/menu_proveedores" class="btn btn-cta dark">Ver Proveedores</a>
        <a href="/equipos/crear" class="btn btn-cta">Crear Equipos</a>
        <a href="/alquileres" class="btn btn-cta alt2">Alquileres</a>
        <a href="/alquileres/nuevo" class="btn btn-cta alt1">Crear Alquiler</a>
      </div>
    </div>

    <!-- Lateral -->
    <div class="col-lg-3">
      <div class="sidebar rounded-2xl shadow-soft">

        <div class="profile-card rounded-2xl shadow-soft">
          <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Perfil">
          <p class="mt-2 mb-1" id="greeting">Hola</p>
          <h5 class="mb-0">
            <strong>
              <span id="userName" th:text="${usuarioNombre} ?: ${#authentication?.name}">USUARIO</span>
            </strong>
          </h5>
        </div>

        <div class="calendar-box mt-3 shadow-soft">
          <h5 class="fw-bold">Calendario</h5>
          <div id="calendar"></div>
          <a href="#" class="d-block mt-2">Calendario completo</a>
          <a href="#" class="d-block">Importar o exportar calendarios</a>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<script>
  // Saludo dinámico según hora local del navegador
  (function () {
    const h = new Date().getHours();
    const saludo = (h >= 5 && h < 12) ? 'Buenos días'
                 : (h >= 12 && h < 19) ? 'Buenas tardes'
                 : 'Buenas noches';
    document.getElementById('greeting').textContent = saludo;
  })();

  // Calendario mejorado (compacto, sin cortes y empezando en lunes)
  document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('calendar');

    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'es',
      firstDay: 1,                 // Lunes
      height: 'auto',              // Altura adaptativa
      expandRows: true,            // Filas completas
      fixedWeekCount: false,       // Mes real (4-6 semanas)
      dayMaxEvents: 2,             // "+x más" si se llena
      moreLinkText: 'más',
      headerToolbar: { left: 'prev', center: 'title', right: 'next' },
      dayHeaderContent: (arg) => {
        // "lu", "ma", "mi", ...
        return arg.date.toLocaleDateString('es-ES', { weekday: 'short' })
                        .replace('.', '').slice(0,2);
      },
      events: [
        { title: 'Entrega equipo', start: '2025-08-05' },
        { title: 'Devolución',     start: '2025-08-12' },
        { title: 'Revisión',       start: '2025-08-20' }
      ]
    });

    calendar.render();
  });
</script>
</body>
</html>
